---
title: "R Notebook"
output: html_notebook
---

## Load libraries and functions

```{r}
source("../R/functions.R")
library(data.table)
library(dataplumbr)
library(foreach)
library(doParallel)
library(DBI)
library(glue)
```

```{r}
con <- get_db_conn()
```

## Create baths_appraised and sale_year
#### Sale Year
Planned analyses include anlysis by year of sale. Creating a separate indexed column for year should be faster than repeatedly using DATEPART('year', sale_date).

#### Bathrooms
Using the Fannie Mae and Freddie Mac Uniform Appraisal Dataset Specification to calculate total bathrooms.
3/4 baths count as full baths, 1/4 baths are dropped, half bath is .1 of full bath, so 1 x full bath & 1 x 3/4 bath & 1 x half bath = 2.1 baths (2 full baths, 1 half bath).

```{sql connection=con}
SELECT *,
       DATE_PART('year', sale_date)::INTEGER AS sale_year,
       NULLIF(coalesce(full_baths, 0) + coalesce(thrqtr_baths, 0) + (.1 * coalesce(half_baths, 0)), 0) AS baths_appraised
INTO corelogic_usda.current_tax_200627_latest_all_add_vars
FROM corelogic_usda.current_tax_200627_latest_all;
```
